local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local player = Players.LocalPlayer

local LocalPlayer = Players.LocalPlayer
local DEFAULT_SPEED = 17
local MACRO_SPEED_BONUS = 1.5
local macroEnabled = false
local fakeKnifeSpawned = false

-- T·∫°o dao fake
local function giveFakeTool()
	local backpack = LocalPlayer:WaitForChild("Backpack")
	if backpack:FindFirstChild("FakeKnife") then return end

	local tool = Instance.new("Tool")
	tool.Name = "FakeKnife"
	tool.RequiresHandle = true
	tool.CanBeDropped = false

	local handle = Instance.new("Part")
	handle.Name = "Handle"
	handle.Size = Vector3.new(0.1, 0.1, 0.1)
	handle.Transparency = 1
	handle.CanCollide = false
	handle.Anchored = false
	handle.Massless = true
	handle.Parent = tool

	tool.Parent = backpack
end

-- Xo√° FakeKnife
local function removeFakeTool()
	local character = LocalPlayer.Character
	local backpack = LocalPlayer:FindFirstChild("Backpack")
	if character and character:FindFirstChild("FakeKnife") then
		character.FakeKnife:Destroy()
	end
	if backpack and backpack:FindFirstChild("FakeKnife") then
		backpack.FakeKnife:Destroy()
	end
end

-- C·∫≠p nh·∫≠t t·ªëc ƒë·ªô
local function updateSpeed()
	local character = LocalPlayer.Character
	if not character then return end
	local humanoid = character:FindFirstChildOfClass("Humanoid")
	if not humanoid then return end

	local holdingTool = false
	for _, tool in pairs(character:GetChildren()) do
		if tool:IsA("Tool") then
			holdingTool = true
			break
		end
	end

	local speed = DEFAULT_SPEED
	if macroEnabled and holdingTool then
		speed = speed + MACRO_SPEED_BONUS
	end

	humanoid.WalkSpeed = speed
end

-- Khi nh√¢n v·∫≠t xu·∫•t hi·ªán l·∫°i
LocalPlayer.CharacterAdded:Connect(function(char)
	task.wait(1)
	updateSpeed()

	char.ChildAdded:Connect(function(child)
		if child:IsA("Tool") then
			updateSpeed()
		end
	end)

	char.ChildRemoved:Connect(function(child)
		if child:IsA("Tool") then
			updateSpeed()
		end
	end)
end)

-- Ph√≠m b·∫•m
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end

	if input.KeyCode == Enum.KeyCode.X then
		if fakeKnifeSpawned then
			removeFakeTool()
			fakeKnifeSpawned = false
		else
			giveFakeTool()
			fakeKnifeSpawned = true
		end
	end

	if input.KeyCode == Enum.KeyCode.R then
		macroEnabled = not macroEnabled
		updateSpeed()
		UserInputService.MouseBehavior = macroEnabled and Enum.MouseBehavior.LockCenter or Enum.MouseBehavior.Default
	end
end)

UserInputService.InputEnded:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	-- kh√¥ng c·∫ßn x·ª≠ l√Ω ·ªü InputEnded n·ªØa v√¨ R gi·ªù l√† toggle
end)

-- Animation Custom Pack
local Animations = {
	Idle1 = "rbxassetid://707742142", -- Mage Idle1
	Idle2 = "rbxassetid://707855907", -- Mage Idle2
	Jump = "rbxassetid://782847020",  -- Oldschool Jump
	Fall = "rbxassetid://782846423",  -- Oldschool Fall
	Walk = "rbxassetid://707897309",  -- Mage Walk
	Run = "rbxassetid://707861613",   -- Mage Run
	Climb = "rbxassetid://707826056", -- Mage Climb
	Swim = "rbxassetid://707876443",  -- Mage Swim
	SwimIdle = "rbxassetid://707894699", -- Mage SwimIdle
}

-- √Åp d·ª•ng animation khi nh√¢n v·∫≠t xu·∫•t hi·ªán
local function applyCustomAnimations(character)
	local animate = character:WaitForChild("Animate", 5)
	if not animate then return end
	animate.idle.Animation1.AnimationId = Animations.Idle1
	animate.idle.Animation2.AnimationId = Animations.Idle2
	animate.jump.JumpAnim.AnimationId = Animations.Jump
	animate.fall.FallAnim.AnimationId = Animations.Fall
	animate.walk.WalkAnim.AnimationId = Animations.Walk
	animate.run.RunAnim.AnimationId = Animations.Run
	animate.climb.ClimbAnim.AnimationId = Animations.Climb
	animate.swim.Swim.AnimationId = Animations.Swim
	animate.swimidle.SwimIdle.AnimationId = Animations.SwimIdle
end

LocalPlayer.CharacterAdded:Connect(function(char)
	task.wait(1)
	local humanoid = char:WaitForChild("Humanoid")

	-- TƒÉng t·ªëc ƒë·ªô t√πy theo tool ƒëang c·∫ßm
	updateSpeed()

	-- Khi c·∫ßm ho·∫∑c th·∫£ tool s·∫Ω t·ª± c·∫≠p nh·∫≠t t·ªëc ƒë·ªô
	char.ChildAdded:Connect(function(child)
		if child:IsA("Tool") then
			updateSpeed()
		end
	end)
	char.ChildRemoved:Connect(function(child)
		if child:IsA("Tool") then
			updateSpeed()
		end
	end)

	-- √Åp d·ª•ng animation
	applyCustomAnimations(char)

	-- T·∫°o ESP cho ng∆∞·ªùi ch∆°i kh√°c
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and espEnabled then
			createESP(plr, getToolStatus(plr))
		end
	end
end)

-- ESP / Auto Shoot / Zoom (gi·ªØ nguy√™n t·ª´ b·∫°n)
local espData = {}
local espEnabled = true
local Colors = {
	knife = Color3.fromRGB(255, 80, 80),
	gun = Color3.fromRGB(80, 180, 255),
	none = Color3.fromRGB(80, 255, 80),
}

local shootOffset = 2.8
local autoShooting = false

local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "MM2_GUI"
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 200, 0, 100)
Frame.Position = UDim2.new(0, 20, 0.5, -50)
Frame.BackgroundTransparency = 0.2
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Visible = false

local UIListLayout = Instance.new("UIListLayout", Frame)
UIListLayout.FillDirection = Enum.FillDirection.Vertical
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 6)

function createButton(text, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -10, 0, 30)
	btn.Position = UDim2.new(0, 5, 0, 0)
	btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.GothamSemibold
	btn.TextSize = 14
	btn.Text = text
	btn.Visible = false
	btn.Parent = Frame
	btn.MouseButton1Click:Connect(callback)
end

function getToolStatus(player)
	if not player.Character then return "none" end
	for _, tool in ipairs(player.Character:GetChildren()) do
		if tool:IsA("Tool") then
			local name = tool.Name:lower()
			if name:find("knife") then return "knife" end
			if name:find("gun") then return "gun" end
		end
	end
	local backpack = player:FindFirstChildOfClass("Backpack")
	if backpack then
		for _, tool in ipairs(backpack:GetChildren()) do
			if tool:IsA("Tool") then
				local name = tool.Name:lower()
				if name:find("knife") then return "knife" end
				if name:find("gun") then return "gun" end
			end
		end
	end
	return "none"
end

function createESP(player, status)
	if not espEnabled or not player.Character then return end
	local head = player.Character:FindFirstChild("Head")
	if not head then return end
	local existing = head:FindFirstChild("NameTagESP")
	if existing then existing:Destroy() end
	local bb = Instance.new("BillboardGui", head)
	bb.Name = "NameTagESP"
	bb.Size = UDim2.new(0, 100, 0, 40)
	bb.StudsOffset = Vector3.new(0, 2.5, 0)
	bb.AlwaysOnTop = true
	bb.Adornee = head
	local label = Instance.new("TextLabel", bb)
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.TextStrokeTransparency = 0.4
	if status == "knife" then
		label.Text = "üî™ " .. player.Name
		label.TextColor3 = Colors.knife
	elseif status == "gun" then
		label.Text = "üî´ " .. player.Name
		label.TextColor3 = Colors.gun
	else
		label.Text = player.Name
		label.TextColor3 = Colors.none
	end
	local hl = player.Character:FindFirstChild("ESPHighlight")
	if hl then hl:Destroy() end
	local highlight = Instance.new("Highlight")
	highlight.Name = "ESPHighlight"
	highlight.FillColor = Colors[status]
	highlight.FillTransparency = 0.7
	highlight.OutlineTransparency = 0.1
	highlight.OutlineColor = Colors[status]
	highlight.Adornee = player.Character
	highlight.Parent = player.Character
	espData[player] = status
end

function removeESP(player)
	if not player.Character then return end
	local head = player.Character:FindFirstChild("Head")
	if head then
		local bb = head:FindFirstChild("NameTagESP")
		if bb then bb:Destroy() end
	end
	local hl = player.Character:FindFirstChild("ESPHighlight")
	if hl then hl:Destroy() end
	espData[player] = nil
end

function updateESP()
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			if espEnabled then
				local status = getToolStatus(plr)
				if espData[plr] ~= status then
					removeESP(plr)
					createESP(plr, status)
				end
			else
				removeESP(plr)
			end
		end
	end
end

RunService.RenderStepped:Connect(updateESP)

function updateDroppedGunESP()
	for _, tool in ipairs(workspace:GetChildren()) do
		if tool:IsA("Tool") and tool.Name == "Gun" then
			local handle = tool:FindFirstChild("Handle") or tool:FindFirstChildWhichIsA("Part")
			if handle and not handle:FindFirstChild("DroppedGunESP") then
				local bb = Instance.new("BillboardGui")
				bb.Name = "DroppedGunESP"
				bb.Size = UDim2.new(0, 100, 0, 40)
				bb.StudsOffset = Vector3.new(0, 2.5, 0)
				bb.AlwaysOnTop = true
				bb.Adornee = handle
				bb.Parent = handle

				local label = Instance.new("TextLabel")
				label.Size = UDim2.new(1, 0, 1, 0)
				label.BackgroundTransparency = 1
				label.TextScaled = true
				label.Font = Enum.Font.GothamBold
				label.TextStrokeTransparency = 0.4
				label.TextColor3 = Color3.fromRGB(255, 255, 0)
				label.Text = "üî´ Dropped Gun"
				label.Parent = bb
			end
		end
	end
end

RunService.RenderStepped:Connect(function()
	updateDroppedGunESP()
end)

RunService.RenderStepped:Connect(function(deltaTime)
	updateESP()
	updateDroppedGunESP()

	if macroEnabled then
		local char = LocalPlayer.Character
		local hum = char and char:FindFirstChildOfClass("Humanoid")
		local hrp = char and char:FindFirstChild("HumanoidRootPart")

		if hum and hrp then
			local holdingTool = false
			for _, tool in pairs(char:GetChildren()) do
				if tool:IsA("Tool") then
					holdingTool = true
					break
				end
			end

			if holdingTool then
				local now = tick()
				if now - lastStep >= 0.04 then -- 0.04s ‚âà 25 FPS b∆∞·ªõc ƒëi
					lastStep = now
				else
					hrp.Velocity = Vector3.new(0, hrp.Velocity.Y, 0)
				end
			end
		end
	end
end)

Players.PlayerAdded:Connect(function(plr)
	plr.CharacterAdded:Connect(function()
		task.wait(1)
		if espEnabled then
			createESP(plr, getToolStatus(plr))
		end
	end)
end)

LocalPlayer.CharacterAdded:Connect(function()
	task.wait(1)
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			if espEnabled then
				createESP(plr, getToolStatus(plr))
			end
		end
	end
end)

function findMurderer()
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and getToolStatus(plr) == "knife" then
			return plr
		end
	end
end

function shootMurderer()
	local murderer = findMurderer()
	if not murderer then return end
	local char = LocalPlayer.Character
	if not char or not char:FindFirstChild("Gun") then return end
	local murdererHRP = murderer.Character and murderer.Character:FindFirstChild("HumanoidRootPart")
	if not murdererHRP then return end
	local predicted = murdererHRP.Position + murdererHRP.AssemblyLinearVelocity * Vector3.new(1, 0.5, 1) * (shootOffset / 15)
	char.Gun.KnifeLocal.CreateBeam.RemoteFunction:InvokeServer(1, predicted, "AH2")
end

function toggleAutoShoot()
	autoShooting = not autoShooting
	if not autoShooting then return end
	while autoShooting do
		task.wait(0.1)
		local murderer = findMurderer()
		if not murderer then continue end
		local hrp = murderer.Character and murderer.Character:FindFirstChild("HumanoidRootPart")
		local myHrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if hrp and myHrp then
			local dir = (hrp.Position - myHrp.Position).Unit * 999
			local params = RaycastParams.new()
			params.FilterDescendantsInstances = {LocalPlayer.Character}
			params.FilterType = Enum.RaycastFilterType.Exclude
			local result = workspace:Raycast(myHrp.Position, dir, params)
			if not result or result.Instance:IsDescendantOf(murderer.Character) then
				shootMurderer()
			end
		end
	end
end

createButton("Shoot Murderer", shootMurderer)
createButton("Auto Shoot Murderer", toggleAutoShoot)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.UserInputType == Enum.UserInputType.MouseButton3 then
		shootMurderer()
	elseif input.KeyCode == Enum.KeyCode.V then
		espEnabled = not espEnabled
		if not espEnabled then
			for _, plr in ipairs(Players:GetPlayers()) do
				if plr ~= LocalPlayer then
					removeESP(plr)
				end
			end
		else
			for _, plr in ipairs(Players:GetPlayers()) do
				if plr ~= LocalPlayer then
					createESP(plr, getToolStatus(plr))
				end
			end
		end
	end
end)

local Camera = workspace.CurrentCamera
local zooming = false
local defaultFOV = Camera.FieldOfView
local zoomFOV = 30

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == Enum.KeyCode.C then
		zooming = true
		Camera.FieldOfView = zoomFOV
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if input.KeyCode == Enum.KeyCode.C and zooming then
		zooming = false
		Camera.FieldOfView = defaultFOV
	end
end)

-- Headless khi v√†o game: x√≥a ƒë·∫ßu, m·∫∑t, t√≥c v√† ph·ª• ki·ªán tr√™n ƒë·∫ßu
local function applyHeadless(character)
	local head = character:FindFirstChild("Head")
	if not head then return end

	-- ·∫®n ƒë·∫ßu v√† m·∫∑t
	head.Transparency = 1
	local face = head:FindFirstChildOfClass("Decal")
	if face then
		face.Transparency = 1
	end

	-- X√≥a t√≥c v√† ph·ª• ki·ªán tr√™n ƒë·∫ßu
	for _, accessory in ipairs(character:GetChildren()) do
		if accessory:IsA("Accessory") then
			-- X√≥a n·∫øu l√† t√≥c
			if accessory.Name:lower():find("hair") then
				accessory:Destroy()
			else
				local handle = accessory:FindFirstChild("Handle")
				if handle and handle:IsA("Part") then
					-- N·∫øu ph·ª• ki·ªán n·∫±m tr√™n ƒë·∫ßu
					if handle.Position.Y > head.Position.Y + 0.5 then
						accessory:Destroy()
					end
				end
			end
		end
	end
end

-- G·ªçi khi nh√¢n v·∫≠t xu·∫•t hi·ªán
LocalPlayer.CharacterAdded:Connect(function(char)
	task.wait(1)
	applyHeadless(char)
end)

if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
	-- T·∫°o n√∫t Shoot cho mobile
	local mobileShootBtn = Instance.new("TextButton")
	mobileShootBtn.Size = UDim2.new(0, 100, 0, 40)
	mobileShootBtn.Position = UDim2.new(1, -110, 1, -50)
	mobileShootBtn.AnchorPoint = Vector2.new(0, 0)
	mobileShootBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
	mobileShootBtn.TextColor3 = Color3.new(1, 1, 1)
	mobileShootBtn.Font = Enum.Font.GothamBold
	mobileShootBtn.TextSize = 14
	mobileShootBtn.Text = "üî´ Shoot"
	mobileShootBtn.Parent = ScreenGui
	mobileShootBtn.Visible = true
	mobileShootBtn.ZIndex = 10

	-- G·ªçi shoot khi nh·∫•n
	mobileShootBtn.MouseButton1Click:Connect(function()
		shootMurderer()
	end)

	-- T√≠nh nƒÉng k√©o n√∫t
	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		local delta = input.Position - dragStart
		mobileShootBtn.Position = UDim2.new(
			0, startPos.X.Offset + delta.X,
			0, startPos.Y.Offset + delta.Y
		)
	end

	mobileShootBtn.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = mobileShootBtn.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	mobileShootBtn.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

if not UserInputService.TouchEnabled then
	-- GUI ch√≠nh
	local gui = Instance.new("ScreenGui", game.CoreGui)
	gui.Name = "HelpUI"

	-- N√∫t m·ªü h∆∞·ªõng d·∫´n
	local openBtn = Instance.new("TextButton")
	openBtn.Name = "OpenHelpBtn"
	openBtn.Size = UDim2.new(0, 60, 0, 25)
	openBtn.Position = UDim2.new(0, 10, 1, -40)
	openBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	openBtn.TextColor3 = Color3.new(1, 1, 1)
	openBtn.Font = Enum.Font.GothamBold
	openBtn.TextSize = 14
	openBtn.Text = "‚ùì"
	openBtn.Parent = gui

	-- Frame n·ªôi dung h∆∞·ªõng d·∫´n
	local helpFrame = Instance.new("Frame")
	helpFrame.Size = UDim2.new(0, 300, 0, 200)
	helpFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	helpFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	helpFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	helpFrame.BorderSizePixel = 0
	helpFrame.Visible = false
	helpFrame.Parent = gui

	Instance.new("UICorner", helpFrame)
	local uipadding = Instance.new("UIPadding", helpFrame)
	uipadding.PaddingTop = UDim.new(0, 10)
	uipadding.PaddingLeft = UDim.new(0, 10)
	uipadding.PaddingRight = UDim.new(0, 10)
	uipadding.PaddingBottom = UDim.new(0, 10)

	local helpText = Instance.new("TextLabel")
	helpText.Size = UDim2.new(1, 0, 1, -40)
	helpText.BackgroundTransparency = 1
	helpText.TextColor3 = Color3.new(1, 1, 1)
	helpText.Font = Enum.Font.Code
	helpText.TextSize = 14
	helpText.TextXAlignment = Enum.TextXAlignment.Left
	helpText.TextYAlignment = Enum.TextYAlignment.Top
	helpText.TextWrapped = true
	helpText.Text = [[
Ph√≠m ƒëi·ªÅu khi·ªÉn:
 - X: T·∫°o / Xo√° dao gi·∫£
 - R: B·∫≠t / T·∫Øt ch·∫ø ƒë·ªô macro tƒÉng t·ªëc
 - V: B·∫≠t / T·∫Øt ESP
 - C: Ph√≥ng to (Zoom)
 - Chu·ªôt gi·ªØa: B·∫Øn k·∫ª c·∫ßm dao
 - Click "Shoot Murderer": b·∫Øn th·ªß c√¥ng
 - Click "Auto Shoot": t·ª± ƒë·ªông b·∫Øn
]]
	helpText.Parent = helpFrame

	-- N√∫t ƒë√≥ng h∆∞·ªõng d·∫´n
	local closeBtn = Instance.new("TextButton")
	closeBtn.Size = UDim2.new(0, 60, 0, 25)
	closeBtn.Position = UDim2.new(1, -65, 1, -30)
	closeBtn.AnchorPoint = Vector2.new(0.5, 0.5)
	closeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	closeBtn.TextColor3 = Color3.new(1, 1, 1)
	closeBtn.Font = Enum.Font.GothamSemibold
	closeBtn.TextSize = 13
	closeBtn.Text = "ƒê√≥ng"
	closeBtn.Parent = helpFrame

	openBtn.MouseButton1Click:Connect(function()
		helpFrame.Visible = true
	end)
	closeBtn.MouseButton1Click:Connect(function()
		helpFrame.Visible = false
	end)

	-- Credit GUI c√≥ hi·ªáu ·ª©ng c·∫ßu v·ªìng
	local creditFrame = Instance.new("Frame")
	creditFrame.Size = UDim2.new(0, 250, 0, 30)
	creditFrame.Position = UDim2.new(0.5, 0, 0, 10)
	creditFrame.AnchorPoint = Vector2.new(0.5, 0)
	creditFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	creditFrame.BorderSizePixel = 2
	creditFrame.Parent = gui
	creditFrame.Active = true
	creditFrame.Draggable = true

	local creditLabel = Instance.new("TextLabel")
	creditLabel.Size = UDim2.new(1, 0, 1, 0)
	creditLabel.BackgroundTransparency = 1
	creditLabel.Text = "Script made by Vhuy/VladdyHop"
	creditLabel.TextScaled = true
	creditLabel.Font = Enum.Font.GothamBold
	creditLabel.TextColor3 = Color3.new(1, 1, 1)
	creditLabel.Parent = creditFrame

	local hue = 0
	RunService.RenderStepped:Connect(function()
		hue = (hue + 1) % 360
		local rainbow = Color3.fromHSV(hue / 360, 1, 1)
		creditLabel.TextColor3 = rainbow
		creditFrame.BorderColor3 = rainbow
	end)

	-- N√∫t gi·∫£m lag c√≥ th·ªÉ k√©o
	local lagGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
	lagGui.Name = "ReduceLagGUI"

	local button = Instance.new("TextButton")
	button.Name = "ReduceLagButton"
	button.Size = UDim2.new(0, 120, 0, 35)
	button.Position = UDim2.new(0.5, -60, 1, -105)
	button.AnchorPoint = Vector2.new(0.5, 0)
	button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	button.TextColor3 = Color3.new(1, 1, 1)
	button.Font = Enum.Font.GothamBold
	button.TextSize = 14
	button.Text = "Gi·∫£m Lag: OFF"
	button.Parent = lagGui
	Instance.new("UICorner", button).CornerRadius = UDim.new(0, 8)

	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		local delta = input.Position - dragStart
		button.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end

	button.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = button.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	button.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)

	local isLagReduced = false
	local function toggleLag()
		isLagReduced = not isLagReduced
		if isLagReduced then
			Lighting.FogEnd = 1e9
			Lighting.GlobalShadows = false
			Lighting.Brightness = 0
			Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
			for _, v in ipairs(Lighting:GetChildren()) do
				if v:IsA("BlurEffect") or v:IsA("ColorCorrectionEffect") then
					v:Destroy()
				end
			end
			button.Text = "Gi·∫£m Lag: ON"
			button.BackgroundColor3 = Color3.fromRGB(30, 180, 30)
		else
			Lighting.FogEnd = 1000
			Lighting.GlobalShadows = true
			Lighting.Brightness = 2
			Lighting.OutdoorAmbient = Color3.fromRGB(127, 127, 127)
			button.Text = "Gi·∫£m Lag: OFF"
			button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
		end
	end

	button.MouseButton1Click:Connect(function()
		if dragging then return end
		toggleLag()
	end)
end

-- ===================== MOBILE GUI =====================
if UserInputService.TouchEnabled then
	local gui = Instance.new("ScreenGui")
	gui.Name = "FakeKnifeMobileGUI"
	gui.ResetOnSpawn = false
	gui.Parent = player:WaitForChild("PlayerGui")

	local fakeKnifeButton = Instance.new("TextButton")
	fakeKnifeButton.Size = UDim2.new(0, 90, 0, 30)
	fakeKnifeButton.Position = UDim2.new(0, 20, 1, -150)
	fakeKnifeButton.AnchorPoint = Vector2.new(0, 0)
	fakeKnifeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
	fakeKnifeButton.TextColor3 = Color3.new(1, 1, 1)
	fakeKnifeButton.Font = Enum.Font.GothamBold
	fakeKnifeButton.TextSize = 12
	fakeKnifeButton.Text = "üé≠ Dao Gi·∫£"
	fakeKnifeButton.AutoButtonColor = true
	fakeKnifeButton.Parent = gui
	Instance.new("UICorner", fakeKnifeButton).CornerRadius = UDim.new(0, 6)

	local dragging = false
	local dragStart, startPos

	local function updateDrag(input)
		local delta = input.Position - dragStart
		fakeKnifeButton.Position = UDim2.new(
			0, startPos.X.Offset + delta.X,
			0, startPos.Y.Offset + delta.Y
		)
	end

	fakeKnifeButton.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = fakeKnifeButton.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	fakeKnifeButton.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.Touch and dragging then
			updateDrag(input)
		end
	end)

	fakeKnifeButton.MouseButton1Click:Connect(function()
		local character = player.Character
		if not character then return end
		local backpack = player:FindFirstChild("Backpack")
		if not backpack then return end

		local existing = character:FindFirstChild("FakeKnife") or backpack:FindFirstChild("FakeKnife")
		if existing then
			existing:Destroy()
		else
			local tool = Instance.new("Tool")
			tool.Name = "FakeKnife"
			tool.RequiresHandle = true
			tool.CanBeDropped = false

			local handle = Instance.new("Part")
			handle.Name = "Handle"
			handle.Size = Vector3.new(1, 1, 3)
			handle.BrickColor = BrickColor.new("Bright red")
			handle.Material = Enum.Material.Neon
			handle.Parent = tool

			tool.Parent = backpack
		end
	end)
end
